# C03 Anti-Patterns - åæ¨¡å¼

**é¢†åŸŸ**: A03_Design_Architecture/B02_Design_Patterns  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-30  
**æœ€åæ›´æ–°**: 2026-01-30

---

## 1. ä¸»é¢˜å®šä½

### 1.1 å®šä¹‰ä¸æœ¬è´¨

åæ¨¡å¼ï¼ˆAnti-Patternsï¼‰æ˜¯æŒ‡åœ¨è½¯ä»¶è®¾è®¡å’Œæ¶æ„ä¸­å¸¸è§ä½†æ— æ•ˆæˆ–é€‚å¾—å…¶åçš„è§£å†³æ–¹æ¡ˆã€‚ä¸æ¨¡å¼ï¼ˆPatternsï¼‰æä¾›ç»è¿‡éªŒè¯çš„æœ€ä½³å®è·µä¸åŒï¼Œåæ¨¡å¼æ­ç¤ºäº†åº”è¯¥é¿å…çš„é™·é˜±å’Œé”™è¯¯åšæ³•ã€‚

åæ¨¡å¼çš„æ¦‚å¿µç”±Andrew Koenigäº1995å¹´é¦–æ¬¡æå‡ºï¼Œå¹¶åœ¨ã€ŠAntiPatterns: Refactoring Software, Architectures, and Projects in Crisisã€‹ï¼ˆ1998å¹´ï¼‰ä¸€ä¹¦ä¸­ç³»ç»ŸåŒ–ã€‚ç†è§£åæ¨¡å¼å¯¹äºæ„å»ºå¥å£®ã€å¯ç»´æŠ¤çš„ç³»ç»Ÿè‡³å…³é‡è¦ã€‚

### 1.2 åæ¨¡å¼çš„åˆ†ç±»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åæ¨¡å¼åˆ†ç±»ä½“ç³»                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    æ¶æ„çº§åæ¨¡å¼                          â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â€¢ å¤§æ³¥çƒ (Big Ball of Mud)                             â”‚   â”‚
â”‚  â”‚  â€¢ çƒŸå›±ç³»ç»Ÿ (Stovepipe Enterprise)                      â”‚   â”‚
â”‚  â”‚  â€¢ ä¾›åº”å•†é”å…¥ (Vendor Lock-In)                          â”‚   â”‚
â”‚  â”‚  â€¢ é‡‘é”¤ (Golden Hammer)                                 â”‚   â”‚
â”‚  â”‚  â€¢ è‡ªåŠ¨ç”Ÿæˆ_crud (Autogenerated Stovepipe)              â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    è®¾è®¡çº§åæ¨¡å¼                          â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â€¢ ä¸Šå¸å¯¹è±¡ (God Object)                                â”‚   â”‚
â”‚  â”‚  â€¢ è´«è¡€é¢†åŸŸæ¨¡å‹ (Anemic Domain Model)                   â”‚   â”‚
â”‚  â”‚  â€¢ å¾ªç¯ä¾èµ– (Circular Dependency)                       â”‚   â”‚
â”‚  â”‚  â€¢ å¹½çµç±» (Poltergeist)                                 â”‚   â”‚
â”‚  â”‚  â€¢ é¢æ¡ä»£ç  (Spaghetti Code)                            â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    å¾®æœåŠ¡åæ¨¡å¼                          â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â€¢ åˆ†å¸ƒå¼å•ä½“ (Distributed Monolith)                    â”‚   â”‚
â”‚  â”‚  â€¢ å¾®æœåŠ¡è¿‡åº¦æ‹†åˆ† (Nanoservices)                        â”‚   â”‚
â”‚  â”‚  â€¢ å…±äº«æ•°æ®åº“ (Shared Database)                         â”‚   â”‚
â”‚  â”‚  â€¢ ç‰ˆæœ¬åœ°ç‹± (Version Hell)                              â”‚   â”‚
â”‚  â”‚  â€¢ çº§è”æ•…éšœ (Cascading Failure)                         â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    äº‘åŸç”Ÿåæ¨¡å¼                          â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â€¢ å®¹å™¨è‚¥èƒ–ç—‡ (Fat Container)                           â”‚   â”‚
â”‚  â”‚  â€¢ é…ç½®æ¼‚ç§» (Configuration Drift)                       â”‚   â”‚
â”‚  â”‚  â€¢ æ— çŠ¶æ€è¿‡åº¦è®¾è®¡ (Over-Engineered Statelessness)       â”‚   â”‚
â”‚  â”‚  â€¢ é”™è¯¯é‡è¯•é£æš´ (Retry Storm)                           â”‚   â”‚
â”‚  â”‚  â€¢ èµ„æºæ³„æ¼ (Resource Leak)                             â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. æ ¸å¿ƒæ¦‚å¿µ

### 2.1 åæ¨¡å¼çš„ç‰¹å¾

æ¯ä¸ªåæ¨¡å¼é€šå¸¸å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š

| ç‰¹å¾ | æè¿° |
|------|------|
| **é‡å¤å‡ºç°** | åœ¨ä¸åŒé¡¹ç›®ã€ä¸åŒå›¢é˜Ÿä¸­åå¤å‡ºç° |
| **çœ‹ä¼¼æ­£ç¡®** | åˆçœ‹èµ·æ¥æ˜¯åˆç†çš„è§£å†³æ–¹æ¡ˆ |
| **è´Ÿé¢åæœ** | æœ€ç»ˆä¼šå¯¼è‡´æŠ€æœ¯å€ºåŠ¡å’Œç³»ç»Ÿé—®é¢˜ |
| **æœ‰æ›´å¥½æ–¹æ¡ˆ** | å­˜åœ¨ç»è¿‡éªŒè¯çš„æ›´å¥½æ›¿ä»£æ–¹æ¡ˆ |

### 2.2 åæ¨¡å¼çš„ç”Ÿå‘½å‘¨æœŸ

```
åæ¨¡å¼æ¼”åŒ–é˜¶æ®µ:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èœœæœˆæœŸ   â”‚â”€â”€â”€â–ºâ”‚  ç§¯ç´¯æœŸ   â”‚â”€â”€â”€â–ºâ”‚  å±æœºæœŸ   â”‚â”€â”€â”€â–ºâ”‚  é‡æ„æœŸ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚               â”‚               â”‚               â”‚
    â–¼               â–¼               â–¼               â–¼
æ–¹æ¡ˆçœ‹ä¼¼æœ‰æ•ˆ     æŠ€æœ¯å€ºåŠ¡ç´¯ç§¯     ç³»ç»Ÿéš¾ä»¥ç»´æŠ¤     é‡å¤§é‡æ„
çŸ­æœŸæ”¶ç›Šæ˜æ˜¾     å¼€å‘é€Ÿåº¦ä¸‹é™     æ•…éšœé¢‘ç¹å‘ç”Ÿ     æˆ–é‡å†™
                å›¢é˜Ÿå£«æ°”ä½è½     ä¸šåŠ¡å—é˜»         åº”ç”¨æ¨¡å¼
```

---

## 3. æŠ€æœ¯å®è·µ - åæ¨¡å¼è¯†åˆ«ä¸é‡æ„

### 3.1 åˆ†å¸ƒå¼å•ä½“ (Distributed Monolith)

#### é—®é¢˜æè¿°
æœåŠ¡è™½ç„¶ç‰©ç†ä¸Šåˆ†ç¦»ï¼Œä½†é€»è¾‘ä¸Šé«˜åº¦è€¦åˆï¼Œæ— æ³•ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•ã€‚

```
åˆ†å¸ƒå¼å•ä½“ç‰¹å¾:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åˆ†å¸ƒå¼å•ä½“æ¶æ„                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ æœåŠ¡A   â”‚â—„â”€â”€â”€â–ºâ”‚ æœåŠ¡B   â”‚â—„â”€â”€â”€â–ºâ”‚ æœåŠ¡C   â”‚                   â”‚
â”‚  â”‚         â”‚     â”‚         â”‚     â”‚         â”‚                   â”‚
â”‚  â”‚ ä»£ç è€¦åˆ â”‚     â”‚ å¾ªç¯ä¾èµ– â”‚     â”‚ åŒæ­¥è°ƒç”¨ â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                   â”‚
â”‚       â”‚               â”‚               â”‚                         â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                       â”‚                                         â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                    â”‚
â”‚                  â”‚ å…±äº«DB  â”‚                                    â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                                 â”‚
â”‚  âŒ ç—‡çŠ¶:                                                        â”‚
â”‚  â€¢ ä¿®æ”¹ä¸€ä¸ªæœåŠ¡éœ€è¦åŒæ—¶éƒ¨ç½²å¤šä¸ªæœåŠ¡                             â”‚
â”‚  â€¢ æ•°æ®åº“Schemaå˜æ›´å½±å“æ‰€æœ‰æœåŠ¡                                 â”‚
â”‚  â€¢ æ— æ³•è¿›è¡ŒA/Bæµ‹è¯•æˆ–é‡‘ä¸é›€å‘å¸ƒ                                  â”‚
â”‚  â€¢ æœåŠ¡é—´å­˜åœ¨å¾ªç¯ä¾èµ–                                           â”‚
â”‚  â€¢ è¿‡åº¦ä½¿ç”¨åŒæ­¥è°ƒç”¨                                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ£€æµ‹ä»£ç 

```python
# distributed_monolith_detector.py
"""
åˆ†å¸ƒå¼å•ä½“æ£€æµ‹å·¥å…·
åˆ†æå¾®æœåŠ¡é—´çš„è€¦åˆåº¦
"""

import json
import re
from typing import Dict, List, Set, Tuple
from dataclasses import dataclass
from collections import defaultdict
import networkx as nx


@dataclass
class ServiceDependency:
    source: str
    target: str
    type: str  # sync, async, shared_db
    endpoints: List[str]
    frequency: int = 0


class DistributedMonolithDetector:
    """åˆ†å¸ƒå¼å•ä½“æ£€æµ‹å™¨"""
    
    def __init__(self, services_path: str):
        self.services_path = services_path
        self.dependencies: List[ServiceDependency] = []
        self.service_graph = nx.DiGraph()
        self.shared_databases: Dict[str, Set[str]] = defaultdict(set)
    
    def analyze_codebase(self) -> Dict:
        """åˆ†æä»£ç åº“ï¼Œæ£€æµ‹åˆ†å¸ƒå¼å•ä½“ç‰¹å¾"""
        results = {
            "coupling_score": 0.0,
            "cyclical_dependencies": [],
            "shared_database_usage": {},
            "sync_call_ratio": 0.0,
            "deployment_coupling": [],
            "recommendations": []
        }
        
        # 1. åˆ†ææœåŠ¡é—´ä¾èµ–
        self._analyze_service_dependencies()
        
        # 2. æ£€æµ‹å¾ªç¯ä¾èµ–
        cycles = self._detect_cycles()
        results["cyclical_dependencies"] = cycles
        
        # 3. åˆ†ææ•°æ®åº“å…±äº«
        db_sharing = self._analyze_database_sharing()
        results["shared_database_usage"] = db_sharing
        
        # 4. è®¡ç®—è€¦åˆåº¦åˆ†æ•°
        coupling_score = self._calculate_coupling_score()
        results["coupling_score"] = coupling_score
        
        # 5. åˆ†æåŒæ­¥è°ƒç”¨æ¯”ä¾‹
        sync_ratio = self._analyze_sync_calls()
        results["sync_call_ratio"] = sync_ratio
        
        # 6. ç”Ÿæˆå»ºè®®
        results["recommendations"] = self._generate_recommendations(
            cycles, db_sharing, coupling_score, sync_ratio
        )
        
        return results
    
    def _analyze_service_dependencies(self):
        """åˆ†ææœåŠ¡é—´ä¾èµ–å…³ç³»"""
        # æ‰«ææœåŠ¡ä»£ç ï¼Œæå–HTTPå®¢æˆ·ç«¯è°ƒç”¨
        for service_dir in self._get_service_dirs():
            service_name = service_dir.name
            
            # æ‰«æRESTå®¢æˆ·ç«¯è°ƒç”¨
            rest_calls = self._scan_rest_clients(service_dir)
            for target, endpoints in rest_calls.items():
                self.dependencies.append(ServiceDependency(
                    source=service_name,
                    target=target,
                    type="sync",
                    endpoints=endpoints
                ))
                self.service_graph.add_edge(service_name, target)
            
            # æ‰«ææ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨
            msg_usage = self._scan_message_queues(service_dir)
            for target, topics in msg_usage.items():
                self.dependencies.append(ServiceDependency(
                    source=service_name,
                    target=target,
                    type="async",
                    endpoints=topics
                ))
            
            # æ‰«ææ•°æ®åº“é…ç½®
            databases = self._scan_database_configs(service_dir)
            for db in databases:
                self.shared_databases[db].add(service_name)
    
    def _detect_cycles(self) -> List[List[str]]:
        """æ£€æµ‹å¾ªç¯ä¾èµ–"""
        try:
            cycles = list(nx.simple_cycles(self.service_graph))
            return cycles
        except:
            return []
    
    def _analyze_database_sharing(self) -> Dict:
        """åˆ†ææ•°æ®åº“å…±äº«æƒ…å†µ"""
        shared = {}
        for db, services in self.shared_databases.items():
            if len(services) > 1:
                shared[db] = {
                    "services": list(services),
                    "count": len(services),
                    "risk_level": "HIGH" if len(services) > 3 else "MEDIUM"
                }
        return shared
    
    def _calculate_coupling_score(self) -> float:
        """è®¡ç®—æœåŠ¡è€¦åˆåº¦åˆ†æ•° (0-100)"""
        if not self.dependencies:
            return 0.0
        
        total_deps = len(self.dependencies)
        sync_deps = sum(1 for d in self.dependencies if d.type == "sync")
        
        # åŒæ­¥ä¾èµ–è¶Šå¤šï¼Œè€¦åˆåº¦è¶Šé«˜
        sync_ratio = sync_deps / total_deps if total_deps > 0 else 0
        
        # è€ƒè™‘å¾ªç¯ä¾èµ–çš„å½±å“
        cycle_penalty = len(self._detect_cycles()) * 10
        
        # è€ƒè™‘æ•°æ®åº“å…±äº«
        db_sharing_penalty = sum(
            len(services) * 5 
            for services in self.shared_databases.values()
        )
        
        score = (sync_ratio * 50) + cycle_penalty + min(db_sharing_penalty, 30)
        return min(score, 100)
    
    def _analyze_sync_calls(self) -> float:
        """åˆ†æåŒæ­¥è°ƒç”¨æ¯”ä¾‹"""
        if not self.dependencies:
            return 0.0
        
        sync_count = sum(1 for d in self.dependencies if d.type == "sync")
        return sync_count / len(self.dependencies)
    
    def _generate_recommendations(
        self, 
        cycles: List[List[str]],
        db_sharing: Dict,
        coupling_score: float,
        sync_ratio: float
    ) -> List[str]:
        """ç”Ÿæˆé‡æ„å»ºè®®"""
        recommendations = []
        
        if coupling_score > 70:
            recommendations.append(
                "ğŸ”´ ä¸¥é‡: ç³»ç»Ÿå‘ˆç°é«˜åº¦è€¦åˆç‰¹å¾ï¼Œå»ºè®®ä¼˜å…ˆè¿›è¡ŒæœåŠ¡è§£è€¦"
            )
        elif coupling_score > 40:
            recommendations.append(
                "ğŸŸ¡ è­¦å‘Š: æœåŠ¡é—´å­˜åœ¨ä¸­åº¦è€¦åˆï¼Œå»ºè®®é€æ­¥ä¼˜åŒ–"
            )
        
        if cycles:
            recommendations.append(
                f"ğŸ”´ æ£€æµ‹åˆ° {len(cycles)} ä¸ªå¾ªç¯ä¾èµ–ï¼Œéœ€é€šè¿‡äº‹ä»¶é©±åŠ¨æˆ–æ¥å£åˆ†ç¦»æ‰“ç ´å¾ªç¯"
            )
        
        if db_sharing:
            recommendations.append(
                f"ğŸŸ¡ å‘ç° {len(db_sharing)} ä¸ªå…±äº«æ•°æ®åº“ï¼Œå»ºè®®å®æ–½Database Per Serviceæ¨¡å¼"
            )
        
        if sync_ratio > 0.7:
            recommendations.append(
                f"ğŸ”´ åŒæ­¥è°ƒç”¨å æ¯” {sync_ratio:.1%}ï¼Œå»ºè®®å¼•å…¥å¼‚æ­¥é€šä¿¡é™ä½è€¦åˆ"
            )
        
        recommendations.extend([
            "å»ºè®®å¼•å…¥API Gatewayç»Ÿä¸€å…¥å£ï¼Œå‡å°‘æœåŠ¡é—´ç›´æ¥è°ƒç”¨",
            "è€ƒè™‘ä½¿ç”¨Sagaæ¨¡å¼å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé¿å…åˆ†å¸ƒå¼é”",
            "å»ºç«‹æœåŠ¡å¥‘çº¦æµ‹è¯•ï¼Œç¡®ä¿æ¥å£å˜æ›´å…¼å®¹æ€§"
        ])
        
        return recommendations
    
    def _scan_rest_clients(self, service_dir) -> Dict[str, List[str]]:
        """æ‰«æRESTå®¢æˆ·ç«¯è°ƒç”¨"""
        # ç®€åŒ–å®ç°ï¼Œå®é™…åº”è§£æä»£ç AST
        return {}
    
    def _scan_message_queues(self, service_dir) -> Dict[str, List[str]]:
        """æ‰«ææ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨"""
        return {}
    
    def _scan_database_configs(self, service_dir) -> List[str]:
        """æ‰«ææ•°æ®åº“é…ç½®"""
        return []
    
    def _get_service_dirs(self) -> List:
        """è·å–æ‰€æœ‰æœåŠ¡ç›®å½•"""
        from pathlib import Path
        return [d for d in Path(self.services_path).iterdir() if d.is_dir()]
    
    def generate_report(self, output_path: str):
        """ç”Ÿæˆæ£€æµ‹æŠ¥å‘Š"""
        results = self.analyze_codebase()
        
        report = f"""
# åˆ†å¸ƒå¼å•ä½“æ£€æµ‹æŠ¥å‘Š

## æ¦‚è§ˆ

| æŒ‡æ ‡ | å€¼ | è¯„ä¼° |
|------|-----|------|
| è€¦åˆåº¦åˆ†æ•° | {results['coupling_score']:.1f}/100 | {'ğŸ”´ ä¸¥é‡' if results['coupling_score'] > 70 else 'ğŸŸ¡ è­¦å‘Š' if results['coupling_score'] > 40 else 'ğŸŸ¢ è‰¯å¥½'} |
| åŒæ­¥è°ƒç”¨æ¯”ä¾‹ | {results['sync_call_ratio']:.1%} | {'ğŸ”´ è¿‡é«˜' if results['sync_call_ratio'] > 0.7 else 'ğŸŸ¡ ä¸­ç­‰' if results['sync_call_ratio'] > 0.4 else 'ğŸŸ¢ è‰¯å¥½'} |
| å¾ªç¯ä¾èµ–æ•°é‡ | {len(results['cyclical_dependencies'])} | {'ğŸ”´ éœ€å¤„ç†' if results['cyclical_dependencies'] else 'ğŸŸ¢ æ— '} |
| å…±äº«æ•°æ®åº“æ•°é‡ | {len(results['shared_database_usage'])} | {'ğŸ”´ éœ€å¤„ç†' if results['shared_database_usage'] else 'ğŸŸ¢ æ— '} |

## è¯¦ç»†åˆ†æ

### å¾ªç¯ä¾èµ–
```
{chr(10).join(f"- {' -> '.join(cycle) + ' -> ' + cycle[0]}" for cycle in results['cyclical_dependencies']) or 'æœªæ£€æµ‹åˆ°å¾ªç¯ä¾èµ–'}
```

### å…±äº«æ•°æ®åº“
```
{json.dumps(results['shared_database_usage'], indent=2)}
```

## é‡æ„å»ºè®®

{chr(10).join(f"{i+1}. {rec}" for i, rec in enumerate(results['recommendations']))}

---
ç”Ÿæˆæ—¶é—´: {__import__('datetime').datetime.now().isoformat()}
"""
        
        with open(output_path, 'w') as f:
            f.write(report)
        
        print(f"Report generated: {output_path}")


# ä½¿ç”¨ç¤ºä¾‹
def example_usage():
    detector = DistributedMonolithDetector("/path/to/services")
    
    # æ¨¡æ‹Ÿæ·»åŠ ä¾èµ–æ•°æ®
    detector.dependencies = [
        ServiceDependency("order-service", "inventory-service", "sync", ["/check"]),
        ServiceDependency("order-service", "payment-service", "sync", ["/charge"]),
        ServiceDependency("payment-service", "notification-service", "async", ["payment.completed"]),
        ServiceDependency("inventory-service", "order-service", "sync", ["/reserve"]),  # å¾ªç¯ä¾èµ–
    ]
    detector.service_graph.add_edge("order-service", "inventory-service")
    detector.service_graph.add_edge("order-service", "payment-service")
    detector.service_graph.add_edge("payment-service", "notification-service")
    detector.service_graph.add_edge("inventory-service", "order-service")  # å¾ªç¯
    
    detector.shared_databases["main_db"].update([
        "order-service", "inventory-service", "payment-service"
    ])
    
    detector.generate_report("/tmp/distributed_monolith_report.md")


if __name__ == "__main__":
    example_usage()
```

#### é‡æ„æ–¹æ¡ˆ

```java
// RefactoringExample.java
/**
 * åˆ†å¸ƒå¼å•ä½“é‡æ„ç¤ºä¾‹
 * 
 * é‡æ„å‰: åŒæ­¥è°ƒç”¨ã€å…±äº«æ•°æ®åº“
 * é‡æ„å: äº‹ä»¶é©±åŠ¨ã€CQRSã€æ¯æœåŠ¡æ•°æ®åº“
 */

// ========== é‡æ„å‰ï¼ˆé—®é¢˜ä»£ç ï¼‰ ==========

@Service
public class OrderServiceBefore {
    
    @Autowired
    private InventoryClient inventoryClient;  // åŒæ­¥è°ƒç”¨
    
    @Autowired
    private PaymentClient paymentClient;      // åŒæ­¥è°ƒç”¨
    
    @Autowired
    private OrderRepository orderRepository;  // å…±äº«æ•°æ®åº“
    
    @Transactional
    public Order createOrder(OrderRequest request) {
        // é—®é¢˜1: åŒæ­¥è°ƒç”¨å¯¼è‡´çº§è”å»¶è¿Ÿ
        InventoryResponse inventory = inventoryClient.checkStock(request.getProductId());
        if (!inventory.isAvailable()) {
            throw new OutOfStockException();
        }
        
        // é—®é¢˜2: åŒæ­¥è°ƒç”¨å¢åŠ äº†å¤±è´¥ç‚¹
        PaymentResponse payment = paymentClient.charge(request.getAmount());
        if (!payment.isSuccess()) {
            throw new PaymentFailedException();
        }
        
        // é—®é¢˜3: æœ¬åœ°äº‹åŠ¡è·¨è¶Šå¤šä¸ªæœåŠ¡
        Order order = new Order(request);
        order.setPaymentId(payment.getId());
        orderRepository.save(order);
        
        // é—®é¢˜4: åŒæ­¥è°ƒç”¨é€šçŸ¥æœåŠ¡
        notificationClient.sendOrderConfirmation(order);
        
        return order;
    }
}

// ========== é‡æ„åï¼ˆè§£å†³æ–¹æ¡ˆï¼‰ ==========

@Service
public class OrderServiceAfter {
    
    private final OrderRepository orderRepository;
    private final OrderEventPublisher eventPublisher;
    private final SagaOrchestrator sagaOrchestrator;
    
    public OrderServiceAfter(
            OrderRepository orderRepository,
            OrderEventPublisher eventPublisher,
            SagaOrchestrator sagaOrchestrator) {
        this.orderRepository = orderRepository;
        this.eventPublisher = eventPublisher;
        this.sagaOrchestrator = sagaOrchestrator;
    }
    
    /**
     * é‡æ„1: ä½¿ç”¨Sagaæ¨¡å¼å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡
     */
    public Mono<Order> createOrder(OrderRequest request) {
        // 1. åˆ›å»ºå¾…å¤„ç†è®¢å•
        Order order = Order.createPending(request);
        
        return orderRepository.save(order)
            .flatMap(savedOrder -> 
                // 2. å¯åŠ¨Sagaç¼–æ’
                sagaOrchestrator.executeOrderSaga(savedOrder)
                    .flatMap(sagaResult -> {
                        if (sagaResult.isSuccess()) {
                            savedOrder.confirm();
                            return orderRepository.save(savedOrder);
                        } else {
                            savedOrder.fail(sagaResult.getError());
                            return orderRepository.save(savedOrder)
                                .then(Mono.error(new OrderFailedException(sagaResult.getError())));
                        }
                    })
            );
    }
    
    /**
     * é‡æ„2: äº‹ä»¶é©±åŠ¨åº“å­˜æ£€æŸ¥
     */
    public Mono<Void> handleInventoryChecked(InventoryCheckedEvent event) {
        return orderRepository.findById(event.getOrderId())
            .flatMap(order -> {
                if (event.isAvailable()) {
                    order.markInventoryReserved();
                    // å‘å¸ƒæ”¯ä»˜å‘½ä»¤
                    return orderRepository.save(order)
                        .doOnSuccess(o -> eventPublisher.publish(
                            new ProcessPaymentCommand(o.getId(), o.getAmount())
                        ));
                } else {
                    order.fail("Out of stock");
                    return orderRepository.save(order);
                }
            })
            .then();
    }
    
    /**
     * é‡æ„3: å¼‚æ­¥å¤„ç†æ”¯ä»˜ç»“æœ
     */
    public Mono<Void> handlePaymentCompleted(PaymentCompletedEvent event) {
        return orderRepository.findById(event.getOrderId())
            .flatMap(order -> {
                order.markPaid(event.getTransactionId());
                return orderRepository.save(order);
            })
            .doOnSuccess(order -> {
                // å¼‚æ­¥å‘é€é€šçŸ¥
                eventPublisher.publish(new OrderConfirmedEvent(order));
            })
            .then();
    }
    
    /**
     * é‡æ„4: CQRS - æŸ¥è¯¢ä¼˜åŒ–
     */
    public Mono<OrderView> getOrderView(String orderId) {
        // ä»ç‰©åŒ–è§†å›¾è¯»å–ï¼Œè€Œéç›´æ¥æŸ¥è¯¢èšåˆæ ¹
        return orderViewRepository.findById(orderId);
    }
}

// ========== Sagaç¼–æ’å™¨ ==========

@Component
public class SagaOrchestrator {
    
    private final StateMachineFactory stateMachineFactory;
    private final CommandGateway commandGateway;
    
    public Mono<SagaResult> executeOrderSaga(Order order) {
        SagaDefinition saga = SagaDefinition.builder()
            .step("checkInventory", 
                ctx -> commandGateway.send(new CheckInventoryCommand(order.getProductId(), order.getQuantity())))
            .compensate("checkInventory",
                ctx -> commandGateway.send(new ReleaseInventoryCommand(order.getProductId(), order.getQuantity())))
            
            .step("processPayment",
                ctx -> commandGateway.send(new ProcessPaymentCommand(order.getId(), order.getAmount())))
            .compensate("processPayment",
                ctx -> commandGateway.send(new RefundPaymentCommand(ctx.getPaymentId())))
            
            .step("createShipment",
                ctx -> commandGateway.send(new CreateShipmentCommand(order.getId(), order.getAddress())))
            .compensate("createShipment",
                ctx -> commandGateway.send(new CancelShipmentCommand(ctx.getShipmentId())))
            
            .build();
        
        return saga.execute(order.getId());
    }
}
```

### 3.2 è´«è¡€é¢†åŸŸæ¨¡å‹ (Anemic Domain Model)

#### é—®é¢˜æè¿°
é¢†åŸŸæ¨¡å‹åªåŒ…å«æ•°æ®ï¼ˆgetter/setterï¼‰ï¼Œä¸šåŠ¡é€»è¾‘å…¨éƒ¨åœ¨æœåŠ¡å±‚ï¼Œè¿åäº†é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ã€‚

```
è´«è¡€æ¨¡å‹ vs å……è¡€æ¨¡å‹:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è´«è¡€é¢†åŸŸæ¨¡å‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   OrderDTO    â”‚      â”‚        OrderService               â”‚  â”‚
â”‚  â”‚               â”‚      â”‚                                   â”‚  â”‚
â”‚  â”‚ - orderId     â”‚      â”‚  + createOrder()                  â”‚  â”‚
â”‚  â”‚ - customerId  â”‚      â”‚  + cancelOrder()                  â”‚  â”‚
â”‚  â”‚ - total       â”‚      â”‚  + calculateDiscount()            â”‚  â”‚
â”‚  â”‚ - status      â”‚      â”‚  + validateOrder()                â”‚  â”‚
â”‚  â”‚               â”‚      â”‚  + processPayment()               â”‚  â”‚
â”‚  â”‚ + getOrderId()â”‚      â”‚                                   â”‚  â”‚
â”‚  â”‚ + setOrderId()â”‚      â”‚  // æ‰€æœ‰ä¸šåŠ¡é€»è¾‘éƒ½åœ¨è¿™é‡Œ           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  âŒ é—®é¢˜:                                                        â”‚
â”‚  â€¢ è¿åå°è£…åŸåˆ™                                                  â”‚
â”‚  â€¢ ä¸šåŠ¡é€»è¾‘åˆ†æ•£                                                  â”‚
â”‚  â€¢ éš¾ä»¥å•å…ƒæµ‹è¯•                                                  â”‚
â”‚  â€¢ æ— æ³•è¡¨è¾¾é¢†åŸŸæ¦‚å¿µ                                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å……è¡€é¢†åŸŸæ¨¡å‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      Order                                â”‚ â”‚
â”‚  â”‚                          (èšåˆæ ¹)                          â”‚ â”‚
â”‚  â”‚  - orderId: OrderId                                       â”‚ â”‚
â”‚  â”‚  - customerId: CustomerId                                 â”‚ â”‚
â”‚  â”‚  - items: List<OrderItem>                                 â”‚ â”‚
â”‚  â”‚  - total: Money                                           â”‚ â”‚
â”‚  â”‚  - status: OrderStatus                                    â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  + addItem(product, quantity, price)                      â”‚ â”‚
â”‚  â”‚  + removeItem(itemId)                                     â”‚ â”‚
â”‚  â”‚  + confirm()                                              â”‚ â”‚
â”‚  â”‚  + cancel()                                               â”‚ â”‚
â”‚  â”‚  + calculateTotal(): Money                                â”‚ â”‚
â”‚  â”‚  + applyDiscount(discountCode): Money                     â”‚ â”‚
â”‚  â”‚  + validate(): ValidationResult                           â”‚ â”‚
â”‚  â”‚  + toSnapshot(): OrderSnapshot                            â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  // ä¸šåŠ¡è§„åˆ™å°è£…åœ¨é¢†åŸŸå¯¹è±¡ä¸­                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  âœ… ä¼˜åŠ¿:                                                        â”‚
â”‚  â€¢ é«˜å†…èšã€ä½è€¦åˆ                                                â”‚
â”‚  â€¢ æ˜“äºå•å…ƒæµ‹è¯•                                                  â”‚
â”‚  â€¢ ä»£ç è‡ªæ–‡æ¡£åŒ–                                                  â”‚
â”‚  â€¢ ç¬¦åˆOOè®¾è®¡åŸåˆ™                                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é‡æ„ä»£ç 

```java
// RichDomainModel.java
package com.example.domain;

import java.math.BigDecimal;
import java.time.LocalDateTime;
import java.util.*;

/**
 * å……è¡€é¢†åŸŸæ¨¡å‹ç¤ºä¾‹ - è®¢å•èšåˆæ ¹
 */
public class Order {
    
    private final OrderId orderId;
    private final CustomerId customerId;
    private final List<OrderItem> items;
    private OrderStatus status;
    private Money total;
    private LocalDateTime createdAt;
    private LocalDateTime confirmedAt;
    private PaymentId paymentId;
    
    // ä¸šåŠ¡è§„åˆ™å¸¸é‡
    private static final int MAX_ITEMS = 100;
    private static final BigDecimal MIN_ORDER_AMOUNT = new BigDecimal("0.01");
    private static final int CANCELLATION_WINDOW_HOURS = 24;
    
    // ========== æ„é€ å‡½æ•°ï¼ˆå·¥å‚æ–¹æ³•ï¼‰ ==========
    
    private Order(OrderId orderId, CustomerId customerId) {
        this.orderId = orderId;
        this.customerId = customerId;
        this.items = new ArrayList<>();
        this.status = OrderStatus.PENDING;
        this.total = Money.zero();
        this.createdAt = LocalDateTime.now();
    }
    
    /**
     * å·¥å‚æ–¹æ³•ï¼šåˆ›å»ºæ–°è®¢å•
     */
    public static Order create(CustomerId customerId) {
        return new Order(OrderId.generate(), customerId);
    }
    
    /**
     * å·¥å‚æ–¹æ³•ï¼šä»æŒä¹…åŒ–çŠ¶æ€é‡å»º
     */
    public static Order reconstruct(OrderSnapshot snapshot) {
        Order order = new Order(snapshot.getOrderId(), snapshot.getCustomerId());
        order.status = snapshot.getStatus();
        order.total = snapshot.getTotal();
        order.createdAt = snapshot.getCreatedAt();
        order.confirmedAt = snapshot.getConfirmedAt();
        order.paymentId = snapshot.getPaymentId();
        
        for (OrderItemSnapshot itemSnapshot : snapshot.getItems()) {
            order.items.add(OrderItem.reconstruct(itemSnapshot));
        }
        
        return order;
    }
    
    // ========== é¢†åŸŸæ–¹æ³•ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰ ==========
    
    /**
     * æ·»åŠ è®¢å•é¡¹ - åŒ…å«ä¸šåŠ¡è§„åˆ™éªŒè¯
     */
    public void addItem(ProductId productId, int quantity, Money unitPrice) {
        // ä¸šåŠ¡è§„åˆ™1: åªèƒ½åœ¨å¾…å¤„ç†çŠ¶æ€æ·»åŠ å•†å“
        if (status != OrderStatus.PENDING) {
            throw new OrderModificationException(
                "Cannot add items to order in status: " + status);
        }
        
        // ä¸šåŠ¡è§„åˆ™2: æœ€å¤§å•†å“æ•°é‡é™åˆ¶
        if (items.size() >= MAX_ITEMS) {
            throw new OrderLimitExceededException(
                "Maximum " + MAX_ITEMS + " items allowed per order");
        }
        
        // ä¸šåŠ¡è§„åˆ™3: æ•°é‡å¿…é¡»ä¸ºæ­£æ•°
        if (quantity <= 0) {
            throw new InvalidQuantityException("Quantity must be positive");
        }
        
        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒå•†å“
        Optional<OrderItem> existingItem = findItemByProduct(productId);
        
        if (existingItem.isPresent()) {
            // æ›´æ–°ç°æœ‰å•†å“æ•°é‡
            existingItem.get().increaseQuantity(quantity);
        } else {
            // æ·»åŠ æ–°å•†å“
            items.add(new OrderItem(productId, quantity, unitPrice));
        }
        
        // é‡æ–°è®¡ç®—æ€»ä»·
        recalculateTotal();
        
        // è®°å½•é¢†åŸŸäº‹ä»¶
        registerEvent(new ItemAddedToOrder(orderId, productId, quantity));
    }
    
    /**
     * ç§»é™¤è®¢å•é¡¹
     */
    public void removeItem(OrderItemId itemId) {
        if (status != OrderStatus.PENDING) {
            throw new OrderModificationException(
                "Cannot remove items from order in status: " + status);
        }
        
        OrderItem item = findItem(itemId)
            .orElseThrow(() -> new OrderItemNotFoundException(itemId));
        
        items.remove(item);
        recalculateTotal();
        
        registerEvent(new ItemRemovedFromOrder(orderId, itemId));
    }
    
    /**
     * ç¡®è®¤è®¢å•
     */
    public void confirm() {
        // ä¸šåŠ¡è§„åˆ™1: åªèƒ½ç¡®è®¤å¾…å¤„ç†è®¢å•
        if (status != OrderStatus.PENDING) {
            throw new InvalidOrderStateException(
                "Cannot confirm order in status: " + status);
        }
        
        // ä¸šåŠ¡è§„åˆ™2: å¿…é¡»åŒ…å«å•†å“
        if (items.isEmpty()) {
            throw new EmptyOrderException("Cannot confirm empty order");
        }
        
        // ä¸šåŠ¡è§„åˆ™3: è®¢å•é‡‘é¢å¿…é¡»å¤§äºæœ€å°å€¼
        if (total.isLessThan(Money.of(MIN_ORDER_AMOUNT))) {
            throw new MinimumOrderAmountException(
                "Order total must be at least " + MIN_ORDER_AMOUNT);
        }
        
        // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
        this.status = OrderStatus.CONFIRMED;
        this.confirmedAt = LocalDateTime.now();
        
        registerEvent(new OrderConfirmed(orderId, confirmedAt, total));
    }
    
    /**
     * å–æ¶ˆè®¢å•
     */
    public void cancel(String reason) {
        // ä¸šåŠ¡è§„åˆ™1: å·²å®Œæˆæˆ–å·²å‘è´§çš„è®¢å•ä¸èƒ½å–æ¶ˆ
        if (status == OrderStatus.SHIPPED || status == OrderStatus.DELIVERED) {
            throw new OrderCancellationException(
                "Cannot cancel order that has been shipped or delivered");
        }
        
        // ä¸šåŠ¡è§„åˆ™2: ç¡®è®¤åçš„è®¢å•åªèƒ½åœ¨æ—¶é—´çª—å£å†…å–æ¶ˆ
        if (status == OrderStatus.CONFIRMED && confirmedAt != null) {
            LocalDateTime cutoff = confirmedAt.plusHours(CANCELLATION_WINDOW_HOURS);
            if (LocalDateTime.now().isAfter(cutoff)) {
                throw new OrderCancellationException(
                    "Cancellation window of " + CANCELLATION_WINDOW_HOURS + 
                    " hours has expired");
            }
        }
        
        this.status = OrderStatus.CANCELLED;
        
        registerEvent(new OrderCancelled(orderId, reason, LocalDateTime.now()));
    }
    
    /**
     * åº”ç”¨æŠ˜æ‰£
     */
    public Money applyDiscount(DiscountCode discountCode) {
        // éªŒè¯æŠ˜æ‰£ç æœ‰æ•ˆæ€§
        Discount discount = validateDiscountCode(discountCode);
        
        // è®¡ç®—æŠ˜æ‰£é‡‘é¢
        Money discountAmount = discount.calculateDiscount(total);
        Money discountedTotal = total.subtract(discountAmount);
        
        // ç¡®ä¿æŠ˜æ‰£åé‡‘é¢ä¸ä¸ºè´Ÿ
        if (discountedTotal.isNegative()) {
            discountAmount = total;
            discountedTotal = Money.zero();
        }
        
        // æ›´æ–°æ€»ä»·
        this.total = discountedTotal;
        
        registerEvent(new DiscountApplied(orderId, discountCode, discountAmount));
        
        return discountAmount;
    }
    
    /**
     * è®°å½•æ”¯ä»˜
     */
    public void recordPayment(PaymentId paymentId, Money amount) {
        if (status != OrderStatus.CONFIRMED) {
            throw new InvalidOrderStateException(
                "Cannot record payment for order in status: " + status);
        }
        
        if (!amount.equals(total)) {
            throw new PaymentAmountMismatchException(
                "Payment amount " + amount + " does not match order total " + total);
        }
        
        this.paymentId = paymentId;
        this.status = OrderStatus.PAID;
        
        registerEvent(new OrderPaid(orderId, paymentId, amount));
    }
    
    // ========== é¢†åŸŸæŸ¥è¯¢æ–¹æ³• ==========
    
    /**
     * éªŒè¯è®¢å•å®Œæ•´æ€§
     */
    public ValidationResult validate() {
        List<String> errors = new ArrayList<>();
        
        if (items.isEmpty()) {
            errors.add("Order must contain at least one item");
        }
        
        if (total.isLessThan(Money.of(MIN_ORDER_AMOUNT))) {
            errors.add("Order total must be at least " + MIN_ORDER_AMOUNT);
        }
        
        for (OrderItem item : items) {
            if (!item.isValid()) {
                errors.add("Invalid item: " + item.getProductId());
            }
        }
        
        return errors.isEmpty() 
            ? ValidationResult.success() 
            : ValidationResult.failure(errors);
    }
    
    /**
     * æ˜¯å¦å¯ä»¥å–æ¶ˆ
     */
    public boolean canBeCancelled() {
        if (status == OrderStatus.SHIPPED || status == OrderStatus.DELIVERED) {
            return false;
        }
        
        if (status == OrderStatus.CONFIRMED && confirmedAt != null) {
            LocalDateTime cutoff = confirmedAt.plusHours(CANCELLATION_WINDOW_HOURS);
            return LocalDateTime.now().isBefore(cutoff);
        }
        
        return true;
    }
    
    /**
     * è·å–å•†å“æ€»æ•°
     */
    public int getTotalItemCount() {
        return items.stream()
            .mapToInt(OrderItem::getQuantity)
            .sum();
    }
    
    // ========== å†…éƒ¨è¾…åŠ©æ–¹æ³• ==========
    
    private void recalculateTotal() {
        this.total = items.stream()
            .map(OrderItem::getSubtotal)
            .reduce(Money.zero(), Money::add);
    }
    
    private Optional<OrderItem> findItem(OrderItemId itemId) {
        return items.stream()
            .filter(item -> item.getItemId().equals(itemId))
            .findFirst();
    }
    
    private Optional<OrderItem> findItemByProduct(ProductId productId) {
        return items.stream()
            .filter(item -> item.getProductId().equals(productId))
            .findFirst();
    }
    
    private Discount validateDiscountCode(DiscountCode code) {
        // å®é™…å®ç°åº”æŸ¥è¯¢æŠ˜æ‰£æœåŠ¡
        return Discount.valueOf(code);
    }
    
    private void registerEvent(DomainEvent event) {
        // å°†äº‹ä»¶æ·»åŠ åˆ°é¢†åŸŸäº‹ä»¶é›†åˆ
        // ç”±èšåˆæ ¹ç®¡ç†å™¨åœ¨äº‹åŠ¡æäº¤æ—¶å‘å¸ƒ
    }
    
    // ========== è½¬æ¢ä¸ºå¿«ç…§ï¼ˆæŒä¹…åŒ–ï¼‰ ==========
    
    public OrderSnapshot toSnapshot() {
        return OrderSnapshot.builder()
            .orderId(orderId)
            .customerId(customerId)
            .items(items.stream().map(OrderItem::toSnapshot).toList())
            .status(status)
            .total(total)
            .createdAt(createdAt)
            .confirmedAt(confirmedAt)
            .paymentId(paymentId)
            .build();
    }
    
    // ========== Getterï¼ˆåªè¯»è®¿é—®ï¼‰ ==========
    
    public OrderId getOrderId() { return orderId; }
    public CustomerId getCustomerId() { return customerId; }
    public List<OrderItem> getItems() { return Collections.unmodifiableList(items); }
    public OrderStatus getStatus() { return status; }
    public Money getTotal() { return total; }
    public LocalDateTime getCreatedAt() { return createdAt; }
}

// ========== å€¼å¯¹è±¡ç¤ºä¾‹ ==========

public record Money(BigDecimal amount, Currency currency) {
    
    public static Money of(BigDecimal amount) {
        return new Money(amount, Currency.getInstance("USD"));
    }
    
    public static Money zero() {
        return new Money(BigDecimal.ZERO, Currency.getInstance("USD"));
    }
    
    public Money add(Money other) {
        if (!this.currency.equals(other.currency)) {
            throw new CurrencyMismatchException();
        }
        return new Money(this.amount.add(other.amount), this.currency);
    }
    
    public Money subtract(Money other) {
        if (!this.currency.equals(other.currency)) {
            throw new CurrencyMismatchException();
        }
        return new Money(this.amount.subtract(other.amount), this.currency);
    }
    
    public boolean isLessThan(Money other) {
        return this.amount.compareTo(other.amount) < 0;
    }
    
    public boolean isNegative() {
        return amount.compareTo(BigDecimal.ZERO) < 0;
    }
}

public record OrderId(String value) {
    public static OrderId generate() {
        return new OrderId(UUID.randomUUID().toString());
    }
}
```

### 3.3 é‡‘é”¤åæ¨¡å¼ (Golden Hammer)

#### é—®é¢˜æè¿°
å›¢é˜Ÿè¿‡åº¦ä¾èµ–ç†Ÿæ‚‰çš„å·¥å…·æˆ–æŠ€æœ¯ï¼Œè¯•å›¾ç”¨å®ƒè§£å†³æ‰€æœ‰é—®é¢˜ï¼Œå³ä½¿å®ƒå¹¶ä¸é€‚åˆã€‚

```
é‡‘é”¤åæ¨¡å¼ç¤ºä¾‹:

âŒ "å¦‚æœåªæœ‰ä¸€æŠŠé”¤å­ï¼Œæ‰€æœ‰ä¸œè¥¿çœ‹èµ·æ¥éƒ½åƒé’‰å­"

åœºæ™¯1: æ‰€æœ‰é—®é¢˜éƒ½ç”¨å¾®æœåŠ¡è§£å†³
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ç®€å•CRUDåº”ç”¨                       â”‚
   â”‚  ç”¨æˆ·: 10äºº                         â”‚
   â”‚  å†³ç­–: "å¿…é¡»ç”¨å¾®æœåŠ¡æ¶æ„ï¼"          â”‚
   â”‚  ç»“æœ: è¿ç»´å¤æ‚åº¦è¿œè¶…ä¸šåŠ¡å¤æ‚åº¦      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åœºæ™¯2: æ‰€æœ‰æ•°æ®éƒ½å­˜MongoDB
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  å¤æ‚æŠ¥è¡¨æŸ¥è¯¢éœ€æ±‚                    â”‚
   â”‚  éœ€è¦å¤šè¡¨JOINå’Œèšåˆ                  â”‚
   â”‚  å†³ç­–: "æˆ‘ä»¬å·²ç»ç†Ÿæ‚‰MongoDB"         â”‚
   â”‚  ç»“æœ: åœ¨åº”ç”¨å±‚å®ç°å¤æ‚çš„JOINé€»è¾‘    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åœºæ™¯3: æ‰€æœ‰é¡¹ç›®éƒ½ç”¨Java
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  æœºå™¨å­¦ä¹ æ¨¡å‹æœåŠ¡                    â”‚
   â”‚  Pythonç”Ÿæ€æ›´æˆç†Ÿ                   â”‚
   â”‚  å†³ç­–: "å›¢é˜Ÿåªä¼šJava"                â”‚
   â”‚  ç»“æœ: ç”¨Javaè°ƒç”¨Pythonè„šæœ¬ï¼Œæ•ˆç‡ä½  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… æ­£ç¡®çš„æŠ€æœ¯é€‰å‹æ€ç»´:

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  é—®é¢˜åˆ†æ â”€â”€â–º è¯„ä¼°é€‰é¡¹ â”€â”€â–º åšå‡ºå†³ç­– â”‚
   â”‚      â”‚            â”‚           â”‚     â”‚
   â”‚      â–¼            â–¼           â–¼     â”‚
   â”‚   éœ€æ±‚ç‰¹æ€§    æŠ€æœ¯ç‰¹æ€§      ROIè¯„ä¼°  â”‚
   â”‚   çº¦æŸæ¡ä»¶    å›¢é˜Ÿèƒ½åŠ›      é£é™©åˆ†æ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æŠ€æœ¯é€‰å‹å†³ç­–æ¡†æ¶

```python
# technology_selection_framework.py
"""
æŠ€æœ¯é€‰å‹å†³ç­–æ¡†æ¶
å¸®åŠ©å›¢é˜Ÿé¿å…é‡‘é”¤åæ¨¡å¼
"""

from dataclasses import dataclass, field
from typing import List, Dict, Optional, Callable
from enum import Enum
import json


class RequirementCategory(Enum):
    FUNCTIONAL = "functional"
    NON_FUNCTIONAL = "non_functional"
    CONSTRAINT = "constraint"


class Priority(Enum):
    MUST_HAVE = 5
    SHOULD_HAVE = 4
    NICE_TO_HAVE = 3
    LOW = 2
    WONT_HAVE = 1


@dataclass
class Requirement:
    """éœ€æ±‚å®šä¹‰"""
    id: str
    description: str
    category: RequirementCategory
    priority: Priority
    acceptance_criteria: List[str] = field(default_factory=list)
    
    def to_dict(self) -> Dict:
        return {
            "id": self.id,
            "description": self.description,
            "category": self.category.value,
            "priority": self.priority.name,
            "acceptance_criteria": self.acceptance_criteria
        }


@dataclass
class TechnologyOption:
    """æŠ€æœ¯é€‰é¡¹è¯„ä¼°"""
    name: str
    description: str
    category: str  # language, database, framework, etc.
    
    # èƒ½åŠ›è¯„åˆ† (1-5)
    capabilities: Dict[str, int] = field(default_factory=dict)
    
    # æˆæœ¬å› ç´ 
    license_cost: str = "free"  # free, low, medium, high
    learning_curve: str = "medium"  # low, medium, high
    operational_complexity: str = "medium"
    
    # ç”Ÿæ€å› ç´ 
    community_size: str = "medium"  # small, medium, large
    maturity: str = "stable"  # experimental, stable, mature
    
    # å›¢é˜Ÿå› ç´ 
    team_experience: int = 3  # 1-5
    hiring_availability: str = "good"  # poor, fair, good, excellent
    
    # é£é™©å› ç´ 
    vendor_lockin_risk: str = "low"  # low, medium, high
    long_term_support: bool = True
    
    def score_against_requirements(self, requirements: List[Requirement]) -> float:
        """æ ¹æ®éœ€æ±‚è®¡ç®—æŠ€æœ¯å¾—åˆ†"""
        total_score = 0
        total_weight = 0
        
        for req in requirements:
            weight = req.priority.value
            
            # æ ¹æ®éœ€æ±‚ç±»åˆ«è¯„ä¼°
            if req.category == RequirementCategory.FUNCTIONAL:
                score = self._score_functional_fit(req)
            elif req.category == RequirementCategory.NON_FUNCTIONAL:
                score = self._score_non_functional_fit(req)
            else:  # CONSTRAINT
                score = self._score_constraint_compliance(req)
            
            total_score += score * weight
            total_weight += weight
        
        return total_score / total_weight if total_weight > 0 else 0
    
    def _score_functional_fit(self, req: Requirement) -> float:
        """è¯„ä¼°åŠŸèƒ½åŒ¹é…åº¦"""
        # ç®€åŒ–å®ç°
        return self.capabilities.get(req.id, 3) / 5.0
    
    def _score_non_functional_fit(self, req: Requirement) -> float:
        """è¯„ä¼°éåŠŸèƒ½éœ€æ±‚æ»¡è¶³åº¦"""
        perf_scores = {
            "performance": self.capabilities.get("performance", 3),
            "scalability": self.capabilities.get("scalability", 3),
            "reliability": self.capabilities.get("reliability", 3)
        }
        return sum(perf_scores.values()) / (len(perf_scores) * 5)
    
    def _score_constraint_compliance(self, req: Requirement) -> float:
        """è¯„ä¼°çº¦æŸæ¡ä»¶æ»¡è¶³åº¦"""
        # çº¦æŸæ¡ä»¶é€šå¸¸æ˜¯äºŒå…ƒçš„
        return 1.0 if req.id in self.capabilities else 0.0


class TechnologySelectionFramework:
    """æŠ€æœ¯é€‰å‹æ¡†æ¶"""
    
    def __init__(self, project_name: str):
        self.project_name = project_name
        self.requirements: List[Requirement] = []
        self.options: List[TechnologyOption] = []
        self.decision_criteria: List[str] = []
    
    def add_requirement(self, requirement: Requirement):
        """æ·»åŠ éœ€æ±‚"""
        self.requirements.append(requirement)
    
    def add_option(self, option: TechnologyOption):
        """æ·»åŠ æŠ€æœ¯é€‰é¡¹"""
        self.options.append(option)
    
    def evaluate(self) -> Dict:
        """æ‰§è¡Œè¯„ä¼°"""
        if not self.requirements:
            raise ValueError("No requirements defined")
        if len(self.options) < 2:
            raise ValueError("Need at least 2 options to compare")
        
        results = []
        
        for option in self.options:
            score = option.score_against_requirements(self.requirements)
            
            # è®¡ç®—é£é™©è°ƒæ•´åçš„å¾—åˆ†
            risk_penalty = self._calculate_risk_penalty(option)
            adjusted_score = score * (1 - risk_penalty)
            
            results.append({
                "option": option.name,
                "raw_score": round(score, 3),
                "risk_penalty": round(risk_penalty, 3),
                "adjusted_score": round(adjusted_score, 3),
                "details": {
                    "capabilities": option.capabilities,
                    "team_experience": option.team_experience,
                    "operational_complexity": option.operational_complexity,
                    "license_cost": option.license_cost
                }
            })
        
        # æ’åº
        results.sort(key=lambda x: x["adjusted_score"], reverse=True)
        
        return {
            "project": self.project_name,
            "evaluation_date": "2026-01-30",
            "requirements_count": len(self.requirements),
            "ranking": results,
            "recommendation": self._generate_recommendation(results),
            "risk_analysis": self._generate_risk_analysis(results[0])
        }
    
    def _calculate_risk_penalty(self, option: TechnologyOption) -> float:
        """è®¡ç®—é£é™©æƒ©ç½šå› å­"""
        penalties = []
        
        # ä¾›åº”å•†é”å®šé£é™©
        lockin_map = {"low": 0.0, "medium": 0.1, "high": 0.2}
        penalties.append(lockin_map.get(option.vendor_lockin_risk, 0.1))
        
        # å­¦ä¹ æ›²çº¿æˆæœ¬
        learning_map = {"low": 0.0, "medium": 0.05, "high": 0.15}
        penalties.append(learning_map.get(option.learning_curve, 0.05))
        
        # è¿è¥å¤æ‚åº¦
        ops_map = {"low": 0.0, "medium": 0.05, "high": 0.1}
        penalties.append(ops_map.get(option.operational_complexity, 0.05))
        
        # å›¢é˜Ÿç»éªŒä¸è¶³
        if option.team_experience < 3:
            penalties.append((3 - option.team_experience) * 0.05)
        
        # é•¿æœŸæ”¯æŒé£é™©
        if not option.long_term_support:
            penalties.append(0.15)
        
        return min(sum(penalties), 0.5)  # æœ€å¤§æƒ©ç½š50%
    
    def _generate_recommendation(self, results: List[Dict]) -> str:
        """ç”Ÿæˆæ¨èå»ºè®®"""
        winner = results[0]
        runner_up = results[1] if len(results) > 1 else None
        
        score_diff = winner["adjusted_score"] - (runner_up["adjusted_score"] if runner_up else 0)
        
        if score_diff > 0.2:
            return f"å¼ºçƒˆå»ºè®®é€‰æ‹© {winner['option']}ï¼Œå…¶å¾—åˆ†æ˜¾è‘—é«˜äºå…¶ä»–é€‰é¡¹ã€‚"
        elif score_diff > 0.1:
            return f"å»ºè®®é€‰æ‹© {winner['option']}ï¼Œä½† {runner_up['option'] if runner_up else 'å…¶ä»–é€‰é¡¹'} ä¹Ÿæ˜¯å¯è¡Œé€‰æ‹©ã€‚"
        else:
            return f"{winner['option']} å’Œ {runner_up['option'] if runner_up else 'å…¶ä»–é€‰é¡¹'} å¾—åˆ†æ¥è¿‘ï¼Œå»ºè®®è¿›è¡ŒPOCéªŒè¯ã€‚"
    
    def _generate_risk_analysis(self, winner: Dict) -> Dict:
        """ç”Ÿæˆé£é™©åˆ†æ"""
        return {
            "primary_risks": [
                "å›¢é˜Ÿéœ€è¦åŸ¹è®­æ—¶é—´",
                "è¿è¥å¤æ‚åº¦å¯èƒ½é«˜äºé¢„æœŸ",
                "ç¬¬ä¸‰æ–¹ä¾èµ–çš„é•¿æœŸæ”¯æŒ"
            ],
            "mitigation_strategies": [
                "å®‰æ’å›¢é˜ŸæŠ€æœ¯åŸ¹è®­",
                "å»ºç«‹å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦",
                "åˆ¶å®šæŠ€æœ¯å€ºåŠ¡ç®¡ç†è®¡åˆ’"
            ]
        }
    
    def generate_report(self, output_path: str):
        """ç”Ÿæˆè¯„ä¼°æŠ¥å‘Š"""
        evaluation = self.evaluate()
        
        report = f"""# æŠ€æœ¯é€‰å‹è¯„ä¼°æŠ¥å‘Š

## é¡¹ç›®ä¿¡æ¯

- **é¡¹ç›®åç§°**: {evaluation['project']}
- **è¯„ä¼°æ—¥æœŸ**: {evaluation['evaluation_date']}
- **éœ€æ±‚æ•°é‡**: {evaluation['requirements_count']}

## éœ€æ±‚æ¸…å•

"""
        for req in self.requirements:
            report += f"- **{req.id}**: {req.description} ({req.priority.name})\n"
        
        report += f"""

## è¯„ä¼°ç»“æœ

| æ’å | æŠ€æœ¯é€‰é¡¹ | åŸå§‹å¾—åˆ† | é£é™©æƒ©ç½š | è°ƒæ•´åå¾—åˆ† |
|------|----------|----------|----------|------------|
"""
        for i, result in enumerate(evaluation['ranking'], 1):
            report += f"| {i} | {result['option']} | {result['raw_score']} | {result['risk_penalty']} | {result['adjusted_score']} |\n"
        
        report += f"""

## æ¨èç»“è®º

{evaluation['recommendation']}

## é£é™©åˆ†æ

### ä¸»è¦é£é™©

"""
        for risk in evaluation['risk_analysis']['primary_risks']:
            report += f"- {risk}\n"
        
        report += "\n### ç¼“è§£ç­–ç•¥\n\n"
        for strategy in evaluation['risk_analysis']['mitigation_strategies']:
            report += f"- {strategy}\n"
        
        report += "\n---\n*æœ¬æŠ¥å‘Šç”±æŠ€æœ¯é€‰å‹æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆ*\n"
        
        with open(output_path, 'w') as f:
            f.write(report)
        
        print(f"Report generated: {output_path}")


# ä½¿ç”¨ç¤ºä¾‹ï¼šæ•°æ®åº“é€‰å‹
def database_selection_example():
    """æ•°æ®åº“é€‰å‹ç¤ºä¾‹"""
    framework = TechnologySelectionFramework("ç”¨æˆ·ç”»åƒç³»ç»Ÿæ•°æ®åº“é€‰å‹")
    
    # æ·»åŠ éœ€æ±‚
    requirements = [
        Requirement(
            id="high_write_throughput",
            description="æ”¯æŒæ¯ç§’10ä¸‡+å†™å…¥",
            category=RequirementCategory.NON_FUNCTIONAL,
            priority=Priority.MUST_HAVE
        ),
        Requirement(
            id="complex_analytics",
            description="æ”¯æŒå¤æ‚èšåˆæŸ¥è¯¢å’ŒJOIN",
            category=RequirementCategory.FUNCTIONAL,
            priority=Priority.MUST_HAVE
        ),
        Requirement(
            id="horizontal_scaling",
            description="æ”¯æŒæ°´å¹³æ‰©å±•",
            category=RequirementCategory.NON_FUNCTIONAL,
            priority=Priority.SHOULD_HAVE
        ),
        Requirement(
            id="json_support",
            description="åŸç”ŸJSONæ”¯æŒ",
            category=RequirementCategory.FUNCTIONAL,
            priority=Priority.NICE_TO_HAVE
        ),
        Requirement(
            id="open_source",
            description="å¼€æºè®¸å¯",
            category=RequirementCategory.CONSTRAINT,
            priority=Priority.MUST_HAVE
        )
    ]
    
    for req in requirements:
        framework.add_requirement(req)
    
    # æ·»åŠ é€‰é¡¹
    options = [
        TechnologyOption(
            name="PostgreSQL",
            description="å…³ç³»å‹æ•°æ®åº“",
            category="database",
            capabilities={
                "high_write_throughput": 3,
                "complex_analytics": 5,
                "horizontal_scaling": 3,
                "json_support": 4,
                "open_source": 5
            },
            team_experience=4,
            operational_complexity="low"
        ),
        TechnologyOption(
            name="MongoDB",
            description="æ–‡æ¡£æ•°æ®åº“",
            category="database",
            capabilities={
                "high_write_throughput": 4,
                "complex_analytics": 2,
                "horizontal_scaling": 4,
                "json_support": 5,
                "open_source": 5
            },
            team_experience=3,
            operational_complexity="medium"
        ),
        TechnologyOption(
            name="ClickHouse",
            description="åˆ—å¼OLAPæ•°æ®åº“",
            category="database",
            capabilities={
                "high_write_throughput": 4,
                "complex_analytics": 5,
                "horizontal_scaling": 4,
                "json_support": 3,
                "open_source": 5
            },
            team_experience=2,
            operational_complexity="medium"
        )
    ]
    
    for opt in options:
        framework.add_option(opt)
    
    # ç”ŸæˆæŠ¥å‘Š
    framework.generate_report("/tmp/db_selection_report.md")


if __name__ == "__main__":
    database_selection_example()
```

---

## 4. èµ„æºç´¢å¼•

### 4.1 ç»å…¸è‘—ä½œ

| ä¹¦å | ä½œè€… | å¹´ä»½ | é‡è¦æ€§ |
|------|------|------|--------|
| AntiPatterns: Refactoring Software, Architectures, and Projects in Crisis | William Brown et al. | 1998 | â­â­â­â­â­ |
| Refactoring: Improving the Design of Existing Code | Martin Fowler | 1999 | â­â­â­â­â­ |
| Clean Code | Robert C. Martin | 2008 | â­â­â­â­â­ |
| Patterns of Enterprise Application Architecture | Martin Fowler | 2002 | â­â­â­â­â­ |
| Domain-Driven Design | Eric Evans | 2003 | â­â­â­â­â­ |

### 4.2 åœ¨çº¿èµ„æº

- **Refactoring Guru**: https://refactoring.guru/
- **Martin Fowler's Blog**: https://martinfowler.com/
- **SourceMaking AntiPatterns**: https://sourcemaking.com/antipatterns

---

## 5. å…³è”çŸ¥è¯†

```mermaid
flowchart TB
    AP[C03_Anti-Patterns]
    
    subgraph Arch["æ¶æ„"]
        MS[C01_Microservices]
        DDD[C02_Domain-Driven_Design]
    end
    
    subgraph Modeling["å»ºæ¨¡"]
        C4[C02_C4_Model]
        UML[C01_UML_Diagrams]
    end
    
    AP -->|é¿å…è®¾è®¡| MS
    AP -->|é¢†åŸŸå»ºæ¨¡| DDD
    AP -->|æ¶æ„æ–‡æ¡£| C4
    AP -->|è®¾è®¡è¡¨è¾¾| UML
```

---

## 6. å­¦ä¹ å»ºè®®

### 6.1 åæ¨¡å¼è¯†åˆ«è®­ç»ƒ

1. **ä»£ç å®¡æŸ¥å®è·µ**: æ¯å‘¨å®¡æŸ¥å›¢é˜Ÿä»£ç ï¼Œè¯†åˆ«åæ¨¡å¼
2. **é‡æ„å·¥ä½œåŠ**: å®šæœŸè¿›è¡Œé‡æ„ç»ƒä¹ 
3. **æ¶æ„å›é¡¾**: æ¯å­£åº¦è¿›è¡Œç³»ç»Ÿæ¶æ„è¯„å®¡

### 6.2 æ¨èä¹¦å•

| é˜¶æ®µ | ä¹¦å | ä½œè€… |
|------|------|------|
| åˆçº§ | ã€Šé‡æ„ã€‹ | Martin Fowler |
| ä¸­çº§ | ã€ŠAntiPatternsã€‹ | Brown et al. |
| é«˜çº§ | ã€ŠImplementing Domain-Driven Designã€‹ | Vaughn Vernon |

---

## 7. é™„å½•

### 7.1 åæ¨¡å¼æ£€æŸ¥æ¸…å•

```
â–¡ æ˜¯å¦å­˜åœ¨å¾ªç¯ä¾èµ–ï¼Ÿ
â–¡ æ˜¯å¦æœ‰ä¸Šå¸ç±»ï¼ˆè¶…è¿‡500è¡Œï¼‰ï¼Ÿ
â–¡ æ˜¯å¦æœ‰è´«è¡€é¢†åŸŸæ¨¡å‹ï¼Ÿ
â–¡ æ˜¯å¦å­˜åœ¨é‡å¤ä»£ç ï¼Ÿ
â–¡ æ˜¯å¦å­˜åœ¨é­”æ³•æ•°å­—ï¼Ÿ
â–¡ æ˜¯å¦æœ‰é•¿å‚æ•°åˆ—è¡¨ï¼Ÿ
â–¡ æ˜¯å¦å­˜åœ¨æ­»ä»£ç ï¼Ÿ
```

### 7.2 ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|------|----------|
| 1.0.0 | 2026-01-30 | åˆå§‹ç‰ˆæœ¬ |

---

> **æ–‡æ¡£ç»´æŠ¤**: æœ¬çŸ¥è¯†åº“éµå¾ªæŒç»­æ›´æ–°åŸåˆ™ã€‚
> 
> **åé¦ˆæ¸ é“**: å¦‚å‘ç°å†…å®¹æœ‰è¯¯æˆ–éœ€è¡¥å……ï¼Œè¯·é€šè¿‡é¡¹ç›®Issueæäº¤åé¦ˆã€‚
